<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Concert Companion</title>
  <meta name="description" content="A mobile-first audience companion app for mood + setting selection during a live concert." />
  <link rel="stylesheet" href="styles.css" />
  <!-- Chart.js (required for the charts section).  -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body>
  <header>
    <h1>Concert Companion</h1>
    <p class="subtitle">Listen. Feel. Create.</p>

    <div class="event-meta" aria-label="Event details">
      <div><strong>Artist:</strong> Markus Gottschlich</div>
      <div><strong>Location:</strong> Museum Performance</div>
      <div><strong>Participation:</strong> Anonymous by default</div>
    </div>
  </header>

  <main>
    <!-- Welcome / instructions -->
    <section class="card" aria-label="Welcome">
      <h2>Welcome</h2>
      <p class="note">
        Help us build a screenplay for tonight’s performance. Select the mood and setting you hear in the music.
        At the end, we’ll reveal the collective story we wrote together.
      </p>
      <p class="hint">
        No login needed. Please avoid entering personal information in notes.
      </p>
    </section>

    <!-- Mood selection -->
    <section class="card" aria-label="Set the Mood">
      <h2>1) Set the Mood.</h2>
      <div id="emotionButtons" class="pill-grid" role="group" aria-label="Mood options">
        <!-- JS renders pills here -->
      </div>
      <p class="hint">Tap one mood that best matches what you feel right now.</p>
    </section>

    <!-- Setting selection -->
    <section class="card" aria-label="Choose the Setting">
      <h2>2) Choose the Setting.</h2>
      <div id="storyButtons" class="pill-grid" role="group" aria-label="Setting options">
        <!-- JS renders pills here -->
      </div>
      <p class="hint">Pick the place or atmosphere the music suggests.</p>
    </section>

    <!-- Optional note -->
    <section class="card" aria-label="Optional note">
      <h2>3) Optional note</h2>
      <p class="note">Add a short note (optional). Keep it brief and non-personal.</p>

      <label for="comment" class="hint" style="display:block;margin-bottom:6px;">Your note (optional)</label>
      <textarea id="comment" maxlength="140" placeholder="A short image, feeling, or idea the music brings up…"></textarea>
      <div id="charHint" class="hint">0 / 140</div>
    </section>

    <!-- Submit -->
    <section class="card" aria-label="Submit response">
      <button id="submitResponse" class="primary" type="button">Add to the Script</button>
      <div id="successMsg" class="success" role="status" aria-live="polite"></div>
    </section>

    <!-- Opt-in email -->
    <section class="card" aria-label="Take the music home">
      <h2>Take the music home.</h2>
      <p class="note">
        Want concert highlights and digital extras after the event? This is optional and separate from participation.
      </p>

      <label class="hint" style="display:flex;gap:10px;align-items:center;margin-top:10px;">
        <input id="optIn" type="checkbox" />
        <span>Send me the highlights.</span>
      </label>

      <div id="emailRow" style="display:none;gap:10px;align-items:center;margin-top:10px;flex-wrap:wrap;">
        <input id="email" type="email" placeholder="you@example.com" autocomplete="email" />
        <button id="saveEmail" class="secondary" type="button">Save Email</button>
      </div>

      <div id="emailMsg" class="success" role="status" aria-live="polite" style="margin-top:8px;"></div>
    </section>

    <!-- Visualizations -->
    <section class="card" aria-label="Collective story visualization">
      <h2>Collective Story (on this device)</h2>
      <p class="note">
        These charts summarize responses stored on <em>this device</em> (prototype behavior). For the live show,
        we’ll connect this to a shared database.
      </p>

      <div class="chart-grid" style="margin-top:12px;">
        <div class="chart-card" aria-label="Mood chart">
          <h3 style="margin:0 0 8px;font-size:1rem;">Mood</h3>
          <canvas id="emotionChart"></canvas>
        </div>

        <div class="chart-card" aria-label="Setting chart">
          <h3 style="margin:0 0 8px;font-size:1rem;">Setting</h3>
          <canvas id="storyChart"></canvas>
        </div>
      </div>

      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;">
        <button id="refreshCharts" class="secondary" type="button">Refresh Charts</button>
        <button id="exportCSV" class="secondary" type="button">Export CSV</button>
        <button id="clearLocal" class="secondary" type="button">Clear Local Data</button>
      </div>

      <div id="exportMsg" class="hint" style="margin-top:10px;"></div>
    </section>
  </main>

  <footer>
    <p>Thank you for participating — enjoy the performance.</p>
  </footer>

  <script src="script.js"></script>
</body>
</html>